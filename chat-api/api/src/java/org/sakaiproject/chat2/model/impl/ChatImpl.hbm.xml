<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
    PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.sakaiproject.chat2.model"
	default-lazy="true">

	<class name="ChatChannel" table="CHAT2_CHANNEL" lazy="true">
		<comment>This table stores chat channels</comment>
		<id name="id" length="36" column="CHANNEL_ID">
			<generator class="uuid.hex" />
		</id>
		<property name="context" column="CONTEXT" type="string"
			length="36" not-null="true" index="CHAT_CHANNEL_CONTEXT_I"/>
		<property name="creationDate" column="CREATION_DATE"
			type="java.util.Date" />

		<property name="title" type="string" length="64" />
		<property name="description" type="string" length="255" />
		<property name="filterType" type="string" length="25" />
		<property name="filterParam" type="int" />
		<property name="contextDefaultChannel" type="boolean" index="CHAT_CHANNEL_DEFAULT_I"/>

		<set name="messages" cascade="all-delete-orphan" inverse="false"
			lazy="true">
			<key column="CHANNEL_ID" />
			<one-to-many class="ChatMessage" />
		</set>

	</class>
	
	<class name="ChatMessage" table="CHAT2_MESSAGE" lazy="true">
		<comment>This table stores chat messages</comment>
		<id name="id" length="36" column="MESSAGE_ID">
			<generator class="uuid.hex" />
		</id>
		<many-to-one name="chatChannel" column="CHANNEL_ID"
			class="ChatChannel" index="CHAT_MESSAGE_CHANNEL_I" />

		<property name="owner" column="OWNER" type="string" length="96"
			not-null="true" />

		<property name="messageDate" column="MESSAGE_DATE"
			type="java.util.Date" index="CHAT_MESSAGE_DATE_I" />
		<property name="body" column="BODY" type="text" not-null="true" />
	</class>

	<query name="findChannelsInContext">
		from ChatChannel c WHERE c.context=? order by c.title
	</query>

	<query name="findDefaultChannelsInContext">
		from ChatChannel c WHERE c.context=? and c.contextDefaultChannel=true order by c.title
	</query>

</hibernate-mapping>
